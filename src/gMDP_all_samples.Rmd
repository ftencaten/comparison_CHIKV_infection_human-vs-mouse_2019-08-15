---
title: "R Notebook"
output: html_notebook
---



```{r}
#Adults
gcadults = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_adult_cohort/fccounts.matrix.infected')

smpladults = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_adult_cohort/samplesinfo_selection.tsv')

smpladults = smpladults[,-3]

#Children
rd <- read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_pediatric_cohort/genecount_matrix_featureCounts.txt') # Read counts file from featureCounts
smpl = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_pediatric_cohort/sample_description_PRJNA390289_tsv_v3.txt') # File with sample information (groups, lib.size)

#samples to remove according MDP
smplrm = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_pediatric_cohort/samples_to_remove_based_on_MDP')

rd = rd[,(colnames(rd) %in% as.vector(smplrm$Sample)) == FALSE]
smpl = smpl[(smpl$run_accession %in% as.vector(smplrm$Sample) == FALSE), ]

#reorder columns from gene count matrix
rd = rd[,order(colnames(rd))]

# Patient samples to remove according MDS plot
rem = c(28,39,43)
remsrr = smpl[smpl$patient %in% rem,1]

rd = rd[,which((colnames(rd) %in% remsrr) == FALSE)]
smpl = smpl[-which(smpl$patient %in% rem),]

rd$Gene.stable.ID = row.names(rd)

smpl = smpl[,c(1,4)]
colnames(smpl) = c('Sample','Class')

#Mice
rdmice <- read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_mouse/genecount_matrix_featureCounts.txt')
ortho = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_mouse/hsapiens_genes_orthologs_mouse.txt')
rdmice$Mouse.gene.name = rownames(rdmice)
out = dplyr::inner_join(rdmice, ortho, by = "Mouse.gene.name")
library(plyr)
#mÃ©dia dos genes duplicados
dat5<-ddply(out,.(Gene.stable.ID),colwise(mean,c(colnames(out)[1:18])))
write.table(dat5,'~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_mouse/genecount_matrix_featureCounts_orthologs_removing_duplicated.txt', sep='\t',quote=F,row.names=F)

rdmice <- read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_mouse/genecount_matrix_featureCounts_orthologs_removing_duplicated.txt')
smplmice = read.delim('~/Dropbox/Projetos/comparison_CHIKV_infection_human-vs-mouse_2019-08-15/diff_expression_mouse/samplesinfo.tsv')

smplmice = smplmice[,-3]

```


MERGE GENE COUNTS ADULTS, MICE, CHILDREN
```{r}
adultmice  = dplyr::inner_join(gcadults, rdmice, by = "Gene.stable.ID")

adultmicechildren  = dplyr::inner_join(adultmice, rd, by = "Gene.stable.ID")

rownames(adultmicechildren) = adultmicechildren$Gene.stable.ID
adultmicechildren = subset(adultmicechildren, select = -Gene.stable.ID)

cpmall = cpm(adultmicechildren)

```
